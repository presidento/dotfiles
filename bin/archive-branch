#!/usr/bin/env bash

branch_name=$1
tag_name=$2

if [ -z "$branch_name" ]; then
    echo "usage: $0 <branch_name>"
    exit 1
fi

if [ -z "$tag_name" ]; then
    tag_name=$branch_name
fi

echo "Archiving '$branch_name' to tag 'a/$tag_name'..."

set -e

git fetch --prune
git checkout "origin/$branch_name" --quiet
git tag "a/$tag_name"
git push origin "a/$tag_name"
git push origin ":$branch_name"

set +e

echo "Archiving finished."

git checkout @{-1}
